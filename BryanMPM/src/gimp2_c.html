<!-- Generated by Cython 0.15.1 on Wed Apr  3 14:44:12 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.15.1 on Wed Apr  3 14:44:12 2013
<p>Raw output: <a href="gimp2_c.c">gimp2_c.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: # cython: profile=True</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "mpm/src/gimp2_c.pyx":1
 * # cython: profile=True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * # cython: cdivision=True
 * # cython: boundscheck=False
 */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # cython: cdivision=True</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # cython: boundscheck=False</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: cimport cython</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line5")'> 5: import numpy as np</pre>
<pre id='line5' class='code' style='background-color: #FFFF8d'>
  /* "mpm/src/gimp2_c.pyx":5
 * # cython: boundscheck=False
 * cimport cython
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cimport numpy as np
 * ctypedef np.int_t ITYPE_t
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: cimport numpy as np</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: ctypedef np.int_t ITYPE_t</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'>
/* "mpm/src/gimp2_c.pyx":7
 * import numpy as np
 * cimport numpy as np
 * ctypedef np.int_t ITYPE_t             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * ctypedef np.double_t FTYPE_t
 * cdef extern from "math.h":
 */
typedef __pyx_t_5numpy_int_t __pyx_t_3mpm_3src_7gimp2_c_ITYPE_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: ctypedef np.double_t FTYPE_t</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: cdef extern from "math.h":</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10:     double sqrt(double x)</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11:     double fabs(double x)</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12:     double floor(double x)</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: </pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line14")'> 14: ITYPE = np.int</pre>
<pre id='line14' class='code' style='background-color: #FFFF6a'>
  /* "mpm/src/gimp2_c.pyx":14
 *     double floor(double x)
 * 
 * ITYPE = np.int             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * FTYPE = np.float
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__ITYPE, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line15")'> 15: FTYPE = np.float</pre>
<pre id='line15' class='code' style='background-color: #FFFF6a'>
  /* "mpm/src/gimp2_c.pyx":15
 * 
 * ITYPE = np.int
 * FTYPE = np.float             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__float);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__FTYPE, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: </pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: </pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: #===============================================================================</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line19")'> 19: def updateContribList( dw, patch, mIdx ):</pre>
<pre id='line19' class='code' style='background-color: #FFFF29'>
/* "mpm/src/gimp2_c.pyx":19
 * 
 * #===============================================================================
 * def updateContribList( dw, patch, mIdx ):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # Update node contribution list
 *     nx = patch.Nc[0]
 */

static PyObject *__pyx_pf_3mpm_3src_7gimp2_c_updateContribList(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3mpm_3src_7gimp2_c_updateContribList = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("updateContribList"), (PyCFunction)__pyx_pf_3mpm_3src_7gimp2_c_updateContribList, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_3mpm_3src_7gimp2_c_updateContribList(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dw = 0;
  PyObject *__pyx_v_patch = 0;
  PyObject *__pyx_v_mIdx = 0;
  PyObject *__pyx_v_nx = NULL;
  PyObject *__pyx_v_th = NULL;
  PyObject *__pyx_v_h = NULL;
  PyObject *__pyx_v_dxdy = NULL;
  PyObject *__pyx_v_ng = NULL;
  PyObject *__pyx_v_inpf = NULL;
  PyObject *__pyx_v_idxs = NULL;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__dw,&__pyx_n_s__patch,&__pyx_n_s__mIdx,0};
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("updateContribList");
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("updateContribList", __pyx_f[0], 19);
  __pyx_self = __pyx_self;
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__dw);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__patch);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribList", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__mIdx);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribList", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "updateContribList") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_dw = values[0];
    __pyx_v_patch = values[1];
    __pyx_v_mIdx = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribList", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("mpm.src.gimp2_c.updateContribList", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "mpm/src/gimp2_c.pyx":19
 * 
 * #===============================================================================
 * def updateContribList( dw, patch, mIdx ):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # Update node contribution list
 *     nx = patch.Nc[0]
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3mpm_3src_7gimp2_c_updateContribList, NULL, __pyx_n_s_14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__updateContribList, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20:     # Update node contribution list</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line21")'> 21:     nx = patch.Nc[0]</pre>
<pre id='line21' class='code' style='background-color: #FFFF8d'>
  /* "mpm/src/gimp2_c.pyx":21
 * def updateContribList( dw, patch, mIdx ):
 *     # Update node contribution list
 *     nx = patch.Nc[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     th = patch.thick
 *     h = patch.dX
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__Nc);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_nx = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line22")'> 22:     th = patch.thick</pre>
<pre id='line22' class='code' style='background-color: #FFFFaa'>
  /* "mpm/src/gimp2_c.pyx":22
 *     # Update node contribution list
 *     nx = patch.Nc[0]
 *     th = patch.thick             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     h = patch.dX
 *     dxdy = h[::-1]/h
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__thick);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_th = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line23")'> 23:     h = patch.dX</pre>
<pre id='line23' class='code' style='background-color: #FFFFaa'>
  /* "mpm/src/gimp2_c.pyx":23
 *     nx = patch.Nc[0]
 *     th = patch.thick
 *     h = patch.dX             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     dxdy = h[::-1]/h
 *     ng = patch.nGhost
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__dX);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_h = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line24")'> 24:     dxdy = h[::-1]/h</pre>
<pre id='line24' class='code' style='background-color: #FFFF62'>
  /* "mpm/src/gimp2_c.pyx":24
 *     th = patch.thick
 *     h = patch.dX
 *     dxdy = h[::-1]/h             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     ng = patch.nGhost
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_h, __pyx_k_slice_1);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_2, __pyx_v_h);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dxdy = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "mpm/src/gimp2_c.pyx":24
 *     th = patch.thick
 *     h = patch.dX
 *     dxdy = h[::-1]/h             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     ng = patch.nGhost
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])
 */
  __pyx_k_slice_1 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, __pyx_int_neg_1);<span class='error_goto'> if (unlikely(!__pyx_k_slice_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_slice_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_k_slice_1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line25")'> 25:     ng = patch.nGhost</pre>
<pre id='line25' class='code' style='background-color: #FFFFaa'>
  /* "mpm/src/gimp2_c.pyx":25
 *     h = patch.dX
 *     dxdy = h[::-1]/h
 *     ng = patch.nGhost             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])
 *     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__nGhost);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_ng = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line26")'> 26:     inpf = np.array([h,dxdy,patch.X0, patch.dX])</pre>
<pre id='line26' class='code' style='background-color: #FFFF31'>
  /* "mpm/src/gimp2_c.pyx":26
 *     dxdy = h[::-1]/h
 *     ng = patch.nGhost
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])
 *     updateContribs( inpf, idxs, ng, th, dw.px, dw.pVol, dw.pF,
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__X0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_patch, __pyx_n_s__dX);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_h);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_h);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_h);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dxdy);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_v_dxdy);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_dxdy);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 3, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_v_inpf = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF1d' onclick='toggleDiv("line27")'> 27:     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])</pre>
<pre id='line27' class='code' style='background-color: #FFFF1d'>
  /* "mpm/src/gimp2_c.pyx":27
 *     ng = patch.nGhost
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])
 *     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     updateContribs( inpf, idxs, ng, th, dw.px, dw.pVol, dw.pF,
 * 		     dw.gx, dw.cIdx, dw.cW, dw.cGrad, mIdx )
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_4, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_nx, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_nx, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_2, __pyx_v_nx);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_2, __pyx_v_nx);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_2, __pyx_v_nx);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 2, __pyx_int_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nx);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 3, __pyx_v_nx);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_nx);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 4, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 5, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 6, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 7, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 8, __pyx_t_7);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
  __pyx_t_4 = 0;
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_7));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_7), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  __pyx_v_idxs = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line28")'> 28:     updateContribs( inpf, idxs, ng, th, dw.px, dw.pVol, dw.pF,</pre>
<pre id='line28' class='code' style='background-color: #FFFF5e'>
  /* "mpm/src/gimp2_c.pyx":28
 *     inpf = np.array([h,dxdy,patch.X0, patch.dX])
 *     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])
 *     updateContribs( inpf, idxs, ng, th, dw.px, dw.pVol, dw.pF,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 		     dw.gx, dw.cIdx, dw.cW, dw.cGrad, mIdx )
 * 
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__updateContribs);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__px);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__pVol);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__pF);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
</pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line29")'> 29: 		     dw.gx, dw.cIdx, dw.cW, dw.cGrad, mIdx )</pre>
<pre id='line29' class='code' style='background-color: #FFFF1f'>
  /* "mpm/src/gimp2_c.pyx":29
 *     idxs = np.array([0,1,2,nx,nx+1,nx+2,2*nx,2*nx+1,2*nx+2])
 *     updateContribs( inpf, idxs, ng, th, dw.px, dw.pVol, dw.pF,
 * 		     dw.gx, dw.cIdx, dw.cW, dw.cGrad, mIdx )             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__gx);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__cIdx);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__cW);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_8 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_dw, __pyx_n_s__cGrad);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(12);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_9));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_inpf);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_v_inpf);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_inpf);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_idxs);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_v_idxs);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_idxs);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ng);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2, __pyx_v_ng);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ng);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_th);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 3, __pyx_v_th);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_th);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 4, __pyx_t_7);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 5, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 6, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 7, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 8, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 9, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 10, __pyx_t_8);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mIdx);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 11, __pyx_v_mIdx);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_mIdx);
  __pyx_t_7 = 0;
  __pyx_t_3 = 0;
  __pyx_t_6 = 0;
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_9), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("mpm.src.gimp2_c.updateContribList", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_nx);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_th);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_h);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dxdy);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ng);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_inpf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_idxs);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: </pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: </pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32: #===============================================================================</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF0c' onclick='toggleDiv("line33")'> 33: def updateContribs( np.ndarray[FTYPE_t, ndim=2] inpf,</pre>
<pre id='line33' class='code' style='background-color: #FFFF0c'>
/* "mpm/src/gimp2_c.pyx":33
 * 
 * #===============================================================================
 * def updateContribs( np.ndarray[FTYPE_t, ndim=2] inpf,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     np.ndarray[ITYPE_t, ndim=1] idxs,
 *                     ITYPE_t ng, FTYPE_t th, np.ndarray[FTYPE_t, ndim=2] px,
 */

static PyObject *__pyx_pf_3mpm_3src_7gimp2_c_1updateContribs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3mpm_3src_7gimp2_c_1updateContribs = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("updateContribs"), (PyCFunction)__pyx_pf_3mpm_3src_7gimp2_c_1updateContribs, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_3mpm_3src_7gimp2_c_1updateContribs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_inpf = 0;
  PyArrayObject *__pyx_v_idxs = 0;
  __pyx_t_3mpm_3src_7gimp2_c_ITYPE_t __pyx_v_ng;
  __pyx_t_3mpm_3src_7gimp2_c_FTYPE_t __pyx_v_th;
  PyArrayObject *__pyx_v_px = 0;
  PyArrayObject *__pyx_v_pVol = 0;
  PyArrayObject *__pyx_v_pF = 0;
  PyArrayObject *__pyx_v_gx = 0;
  PyArrayObject *__pyx_v_cIdx = 0;
  PyArrayObject *__pyx_v_cW = 0;
  PyArrayObject *__pyx_v_cGrad = 0;
  PyArrayObject *__pyx_v_mIdx = 0;
  int __pyx_v_nParts;
  int __pyx_v_cc;
  int __pyx_v_idx;
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_kk;
  int __pyx_v_mm;
  double __pyx_v_x;
  double __pyx_v_r;
  double __pyx_v_h;
  double __pyx_v_l;
  double __pyx_v_sgn;
  double *__pyx_v_hh;
  double *__pyx_v_pp;
  double *__pyx_v_ll;
  double *__pyx_v_S;
  double *__pyx_v_G;
  int *__pyx_v_cix;
  Py_buffer __pyx_bstruct_mIdx;
  Py_ssize_t __pyx_bstride_0_mIdx = 0;
  Py_ssize_t __pyx_bshape_0_mIdx = 0;
  Py_buffer __pyx_bstruct_gx;
  Py_ssize_t __pyx_bstride_0_gx = 0;
  Py_ssize_t __pyx_bstride_1_gx = 0;
  Py_ssize_t __pyx_bshape_0_gx = 0;
  Py_ssize_t __pyx_bshape_1_gx = 0;
  Py_buffer __pyx_bstruct_pF;
  Py_ssize_t __pyx_bstride_0_pF = 0;
  Py_ssize_t __pyx_bstride_1_pF = 0;
  Py_ssize_t __pyx_bstride_2_pF = 0;
  Py_ssize_t __pyx_bshape_0_pF = 0;
  Py_ssize_t __pyx_bshape_1_pF = 0;
  Py_ssize_t __pyx_bshape_2_pF = 0;
  Py_buffer __pyx_bstruct_idxs;
  Py_ssize_t __pyx_bstride_0_idxs = 0;
  Py_ssize_t __pyx_bshape_0_idxs = 0;
  Py_buffer __pyx_bstruct_px;
  Py_ssize_t __pyx_bstride_0_px = 0;
  Py_ssize_t __pyx_bstride_1_px = 0;
  Py_ssize_t __pyx_bshape_0_px = 0;
  Py_ssize_t __pyx_bshape_1_px = 0;
  Py_buffer __pyx_bstruct_cGrad;
  Py_ssize_t __pyx_bstride_0_cGrad = 0;
  Py_ssize_t __pyx_bstride_1_cGrad = 0;
  Py_ssize_t __pyx_bstride_2_cGrad = 0;
  Py_ssize_t __pyx_bshape_0_cGrad = 0;
  Py_ssize_t __pyx_bshape_1_cGrad = 0;
  Py_ssize_t __pyx_bshape_2_cGrad = 0;
  Py_buffer __pyx_bstruct_cW;
  Py_ssize_t __pyx_bstride_0_cW = 0;
  Py_ssize_t __pyx_bstride_1_cW = 0;
  Py_ssize_t __pyx_bshape_0_cW = 0;
  Py_ssize_t __pyx_bshape_1_cW = 0;
  Py_buffer __pyx_bstruct_inpf;
  Py_ssize_t __pyx_bstride_0_inpf = 0;
  Py_ssize_t __pyx_bstride_1_inpf = 0;
  Py_ssize_t __pyx_bshape_0_inpf = 0;
  Py_ssize_t __pyx_bshape_1_inpf = 0;
  Py_buffer __pyx_bstruct_pVol;
  Py_ssize_t __pyx_bstride_0_pVol = 0;
  Py_ssize_t __pyx_bshape_0_pVol = 0;
  Py_buffer __pyx_bstruct_cIdx;
  Py_ssize_t __pyx_bstride_0_cIdx = 0;
  Py_ssize_t __pyx_bstride_1_cIdx = 0;
  Py_ssize_t __pyx_bshape_0_cIdx = 0;
  Py_ssize_t __pyx_bshape_1_cIdx = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__inpf,&__pyx_n_s__idxs,&__pyx_n_s__ng,&__pyx_n_s__th,&__pyx_n_s__px,&__pyx_n_s__pVol,&__pyx_n_s__pF,&__pyx_n_s__gx,&__pyx_n_s__cIdx,&__pyx_n_s__cW,&__pyx_n_s__cGrad,&__pyx_n_s__mIdx,0};
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("updateContribs");
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("updateContribs", __pyx_f[0], 33);
  __pyx_self = __pyx_self;
  {
    PyObject* values[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__inpf);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__idxs);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ng);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__th);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__px);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__pVol);
        if (likely(values[5])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 5);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__pF);
        if (likely(values[6])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 6);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__gx);
        if (likely(values[7])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 7);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  8:
        values[8] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cIdx);
        if (likely(values[8])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 8);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  9:
        values[9] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cW);
        if (likely(values[9])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 9);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 10:
        values[10] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cGrad);
        if (likely(values[10])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 10);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 11:
        values[11] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__mIdx);
        if (likely(values[11])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, 11);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "updateContribs") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 12) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
    }
    __pyx_v_inpf = ((PyArrayObject *)values[0]);
    __pyx_v_idxs = ((PyArrayObject *)values[1]);
    __pyx_v_ng = <span class='pyx_c_api'>__Pyx_PyInt_from_py_npy_long</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_ng == (npy_long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_th = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_th == (npy_double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_px = ((PyArrayObject *)values[4]);
    __pyx_v_pVol = ((PyArrayObject *)values[5]);
    __pyx_v_pF = ((PyArrayObject *)values[6]);
    __pyx_v_gx = ((PyArrayObject *)values[7]);
    __pyx_v_cIdx = ((PyArrayObject *)values[8]);
    __pyx_v_cW = ((PyArrayObject *)values[9]);
    __pyx_v_cGrad = ((PyArrayObject *)values[10]);
    __pyx_v_mIdx = ((PyArrayObject *)values[11]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("updateContribs", 1, 12, 12, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("mpm.src.gimp2_c.updateContribs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_inpf.buf = NULL;
  __pyx_bstruct_idxs.buf = NULL;
  __pyx_bstruct_px.buf = NULL;
  __pyx_bstruct_pVol.buf = NULL;
  __pyx_bstruct_pF.buf = NULL;
  __pyx_bstruct_gx.buf = NULL;
  __pyx_bstruct_cIdx.buf = NULL;
  __pyx_bstruct_cW.buf = NULL;
  __pyx_bstruct_cGrad.buf = NULL;
  __pyx_bstruct_mIdx.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_inpf), __pyx_ptype_5numpy_ndarray, 1, "inpf", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_idxs), __pyx_ptype_5numpy_ndarray, 1, "idxs", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_px), __pyx_ptype_5numpy_ndarray, 1, "px", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_pVol), __pyx_ptype_5numpy_ndarray, 1, "pVol", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_pF), __pyx_ptype_5numpy_ndarray, 1, "pF", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_gx), __pyx_ptype_5numpy_ndarray, 1, "gx", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cIdx), __pyx_ptype_5numpy_ndarray, 1, "cIdx", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cW), __pyx_ptype_5numpy_ndarray, 1, "cW", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cGrad), __pyx_ptype_5numpy_ndarray, 1, "cGrad", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mIdx), __pyx_ptype_5numpy_ndarray, 1, "mIdx", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_inpf, (PyObject*)__pyx_v_inpf, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_inpf = __pyx_bstruct_inpf.strides[0]; __pyx_bstride_1_inpf = __pyx_bstruct_inpf.strides[1];
  __pyx_bshape_0_inpf = __pyx_bstruct_inpf.shape[0]; __pyx_bshape_1_inpf = __pyx_bstruct_inpf.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_idxs, (PyObject*)__pyx_v_idxs, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_ITYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_idxs = __pyx_bstruct_idxs.strides[0];
  __pyx_bshape_0_idxs = __pyx_bstruct_idxs.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_px, (PyObject*)__pyx_v_px, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_px = __pyx_bstruct_px.strides[0]; __pyx_bstride_1_px = __pyx_bstruct_px.strides[1];
  __pyx_bshape_0_px = __pyx_bstruct_px.shape[0]; __pyx_bshape_1_px = __pyx_bstruct_px.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_pVol, (PyObject*)__pyx_v_pVol, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_pVol = __pyx_bstruct_pVol.strides[0];
  __pyx_bshape_0_pVol = __pyx_bstruct_pVol.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_pF, (PyObject*)__pyx_v_pF, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_pF = __pyx_bstruct_pF.strides[0]; __pyx_bstride_1_pF = __pyx_bstruct_pF.strides[1]; __pyx_bstride_2_pF = __pyx_bstruct_pF.strides[2];
  __pyx_bshape_0_pF = __pyx_bstruct_pF.shape[0]; __pyx_bshape_1_pF = __pyx_bstruct_pF.shape[1]; __pyx_bshape_2_pF = __pyx_bstruct_pF.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_gx, (PyObject*)__pyx_v_gx, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_gx = __pyx_bstruct_gx.strides[0]; __pyx_bstride_1_gx = __pyx_bstruct_gx.strides[1];
  __pyx_bshape_0_gx = __pyx_bstruct_gx.shape[0]; __pyx_bshape_1_gx = __pyx_bstruct_gx.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_cIdx, (PyObject*)__pyx_v_cIdx, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_ITYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_cIdx = __pyx_bstruct_cIdx.strides[0]; __pyx_bstride_1_cIdx = __pyx_bstruct_cIdx.strides[1];
  __pyx_bshape_0_cIdx = __pyx_bstruct_cIdx.shape[0]; __pyx_bshape_1_cIdx = __pyx_bstruct_cIdx.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_cW, (PyObject*)__pyx_v_cW, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_cW = __pyx_bstruct_cW.strides[0]; __pyx_bstride_1_cW = __pyx_bstruct_cW.strides[1];
  __pyx_bshape_0_cW = __pyx_bstruct_cW.shape[0]; __pyx_bshape_1_cW = __pyx_bstruct_cW.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_cGrad, (PyObject*)__pyx_v_cGrad, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_cGrad = __pyx_bstruct_cGrad.strides[0]; __pyx_bstride_1_cGrad = __pyx_bstruct_cGrad.strides[1]; __pyx_bstride_2_cGrad = __pyx_bstruct_cGrad.strides[2];
  __pyx_bshape_0_cGrad = __pyx_bstruct_cGrad.shape[0]; __pyx_bshape_1_cGrad = __pyx_bstruct_cGrad.shape[1]; __pyx_bshape_2_cGrad = __pyx_bstruct_cGrad.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_mIdx, (PyObject*)__pyx_v_mIdx, &__Pyx_TypeInfo_nn___pyx_t_3mpm_3src_7gimp2_c_ITYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_mIdx = __pyx_bstruct_mIdx.strides[0];
  __pyx_bshape_0_mIdx = __pyx_bstruct_mIdx.shape[0];

  /* "mpm/src/gimp2_c.pyx":33
 * 
 * #===============================================================================
 * def updateContribs( np.ndarray[FTYPE_t, ndim=2] inpf,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     np.ndarray[ITYPE_t, ndim=1] idxs,
 *                     ITYPE_t ng, FTYPE_t th, np.ndarray[FTYPE_t, ndim=2] px,
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3mpm_3src_7gimp2_c_1updateContribs, NULL, __pyx_n_s_14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__updateContribs, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34:                     np.ndarray[ITYPE_t, ndim=1] idxs,</pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35:                     ITYPE_t ng, FTYPE_t th, np.ndarray[FTYPE_t, ndim=2] px,</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36:                     np.ndarray[FTYPE_t, ndim=1] pVol,</pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:                     np.ndarray[FTYPE_t, ndim=3] pF,</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:                     np.ndarray[FTYPE_t, ndim=2] gx,</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:                     np.ndarray[ITYPE_t, ndim=2] cIdx,</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40:                     np.ndarray[FTYPE_t, ndim=2] cW,</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:                     np.ndarray[FTYPE_t, ndim=3] cGrad,</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42: 	            np.ndarray[ITYPE_t, ndim=1] mIdx ):</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:     # inpf - float input vector - h, dxdy, patch.X0, patch.dX</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:     cdef int nParts = mIdx.shape[0]</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":44
 * 	            np.ndarray[ITYPE_t, ndim=1] mIdx ):
 *     # inpf - float input vector - h, dxdy, patch.X0, patch.dX
 *     cdef int nParts = mIdx.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int cc, idx
 *     cdef int ii, jj, kk, mm
 */
  __pyx_v_nParts = (__pyx_v_mIdx->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:     cdef int cc, idx</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:     cdef int ii, jj, kk, mm</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:     cdef double x, r, h, l, sgn</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:     cdef double* hh = [inpf[0,0],inpf[0,1]]</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":48
 *     cdef int ii, jj, kk, mm
 *     cdef double x, r, h, l, sgn
 *     cdef double* hh = [inpf[0,0],inpf[0,1]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double* pp = [0.,0.]
 *     cdef double* ll = [0.,0.]
 */
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  if (__pyx_t_1 <code><</code> 0) __pyx_t_1 += __pyx_bshape_0_inpf;
  if (__pyx_t_2 <code><</code> 0) __pyx_t_2 += __pyx_bshape_1_inpf;
  __pyx_t_3 = 0;
  __pyx_t_4 = 1;
  if (__pyx_t_3 <code><</code> 0) __pyx_t_3 += __pyx_bshape_0_inpf;
  if (__pyx_t_4 <code><</code> 0) __pyx_t_4 += __pyx_bshape_1_inpf;
  __pyx_t_5[0] = (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_inpf.buf, __pyx_t_1, __pyx_bstride_0_inpf, __pyx_t_2, __pyx_bstride_1_inpf));
  __pyx_t_5[1] = (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_inpf.buf, __pyx_t_3, __pyx_bstride_0_inpf, __pyx_t_4, __pyx_bstride_1_inpf));
  __pyx_v_hh = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:     cdef double* pp = [0.,0.]</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":49
 *     cdef double x, r, h, l, sgn
 *     cdef double* hh = [inpf[0,0],inpf[0,1]]
 *     cdef double* pp = [0.,0.]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double* ll = [0.,0.]
 *     cdef double* S = [0.,0.]
 */
  __pyx_t_6[0] = 0.;
  __pyx_t_6[1] = 0.;
  __pyx_v_pp = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:     cdef double* ll = [0.,0.]</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":50
 *     cdef double* hh = [inpf[0,0],inpf[0,1]]
 *     cdef double* pp = [0.,0.]
 *     cdef double* ll = [0.,0.]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double* S = [0.,0.]
 *     cdef double* G = [0.,0.]
 */
  __pyx_t_7[0] = 0.;
  __pyx_t_7[1] = 0.;
  __pyx_v_ll = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:     cdef double* S = [0.,0.]</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":51
 *     cdef double* pp = [0.,0.]
 *     cdef double* ll = [0.,0.]
 *     cdef double* S = [0.,0.]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double* G = [0.,0.]
 *     cdef int* cix = [0,0]
 */
  __pyx_t_8[0] = 0.;
  __pyx_t_8[1] = 0.;
  __pyx_v_S = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:     cdef double* G = [0.,0.]</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":52
 *     cdef double* ll = [0.,0.]
 *     cdef double* S = [0.,0.]
 *     cdef double* G = [0.,0.]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int* cix = [0,0]
 * 
 */
  __pyx_t_9[0] = 0.;
  __pyx_t_9[1] = 0.;
  __pyx_v_G = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:     cdef int* cix = [0,0]</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":53
 *     cdef double* S = [0.,0.]
 *     cdef double* G = [0.,0.]
 *     cdef int* cix = [0,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for mm in range(nParts):
 */
  __pyx_t_10[0] = 0;
  __pyx_t_10[1] = 0;
  __pyx_v_cix = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54: </pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:     for mm in range(nParts):</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'>
  /* "mpm/src/gimp2_c.pyx":55
 *     cdef int* cix = [0,0]
 * 
 *     for mm in range(nParts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         ii = mIdx[mm]
 * 
 */
  __pyx_t_11 = __pyx_v_nParts;
  for (__pyx_t_12 = 0; __pyx_t_12 <code><</code> __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_mm = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:         ii = mIdx[mm]</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'>
    /* "mpm/src/gimp2_c.pyx":56
 * 
 *     for mm in range(nParts):
 *         ii = mIdx[mm]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 	# Get Cell
 */
    __pyx_t_13 = __pyx_v_mm;
    if (__pyx_t_13 <code><</code> 0) __pyx_t_13 += __pyx_bshape_0_mIdx;
    __pyx_v_ii = (*__Pyx_BufPtrStrided1d(__pyx_t_3mpm_3src_7gimp2_c_ITYPE_t *, __pyx_bstruct_mIdx.buf, __pyx_t_13, __pyx_bstride_0_mIdx));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57: </pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: 	# Get Cell</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59:         for kk in range(2):</pre>
<pre id='line59' class='code' style='background-color: #FFFFff'>
    /* "mpm/src/gimp2_c.pyx":59
 * 
 * 	# Get Cell
 *         for kk in range(2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             pp[kk] = px[ii,kk]
 *             ll[kk] = sqrt(pVol[ii] / (4.*th*inpf[1,kk])) * pF[ii,kk,kk]
 */
    for (__pyx_t_14 = 0; __pyx_t_14 <code><</code> 2; __pyx_t_14+=1) {
      __pyx_v_kk = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:             pp[kk] = px[ii,kk]</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":60
 * 	# Get Cell
 *         for kk in range(2):
 *             pp[kk] = px[ii,kk]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ll[kk] = sqrt(pVol[ii] / (4.*th*inpf[1,kk])) * pF[ii,kk,kk]
 * 
 */
      __pyx_t_15 = __pyx_v_ii;
      __pyx_t_16 = __pyx_v_kk;
      if (__pyx_t_15 <code><</code> 0) __pyx_t_15 += __pyx_bshape_0_px;
      if (__pyx_t_16 <code><</code> 0) __pyx_t_16 += __pyx_bshape_1_px;
      (__pyx_v_pp[__pyx_v_kk]) = (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_px.buf, __pyx_t_15, __pyx_bstride_0_px, __pyx_t_16, __pyx_bstride_1_px));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61:             ll[kk] = sqrt(pVol[ii] / (4.*th*inpf[1,kk])) * pF[ii,kk,kk]</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":61
 *         for kk in range(2):
 *             pp[kk] = px[ii,kk]
 *             ll[kk] = sqrt(pVol[ii] / (4.*th*inpf[1,kk])) * pF[ii,kk,kk]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             x = (pp[kk] - inpf[2,kk])/inpf[3,kk] + ng;
 */
      __pyx_t_17 = __pyx_v_ii;
      if (__pyx_t_17 <code><</code> 0) __pyx_t_17 += __pyx_bshape_0_pVol;
      __pyx_t_18 = 1;
      __pyx_t_19 = __pyx_v_kk;
      if (__pyx_t_18 <code><</code> 0) __pyx_t_18 += __pyx_bshape_0_inpf;
      if (__pyx_t_19 <code><</code> 0) __pyx_t_19 += __pyx_bshape_1_inpf;
      __pyx_t_20 = __pyx_v_ii;
      __pyx_t_21 = __pyx_v_kk;
      __pyx_t_22 = __pyx_v_kk;
      if (__pyx_t_20 <code><</code> 0) __pyx_t_20 += __pyx_bshape_0_pF;
      if (__pyx_t_21 <code><</code> 0) __pyx_t_21 += __pyx_bshape_1_pF;
      if (__pyx_t_22 <code><</code> 0) __pyx_t_22 += __pyx_bshape_2_pF;
      (__pyx_v_ll[__pyx_v_kk]) = (sqrt(((*__Pyx_BufPtrStrided1d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_pVol.buf, __pyx_t_17, __pyx_bstride_0_pVol)) / ((4. * __pyx_v_th) * (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_inpf.buf, __pyx_t_18, __pyx_bstride_0_inpf, __pyx_t_19, __pyx_bstride_1_inpf))))) * (*__Pyx_BufPtrStrided3d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_pF.buf, __pyx_t_20, __pyx_bstride_0_pF, __pyx_t_21, __pyx_bstride_1_pF, __pyx_t_22, __pyx_bstride_2_pF)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62: </pre>
<pre id='line62' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63:             x = (pp[kk] - inpf[2,kk])/inpf[3,kk] + ng;</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":63
 *             ll[kk] = sqrt(pVol[ii] / (4.*th*inpf[1,kk])) * pF[ii,kk,kk]
 * 
 *             x = (pp[kk] - inpf[2,kk])/inpf[3,kk] + ng;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             cix[kk] = int(floor(x))
 *             if (x - 1.*cix[kk]) <code><</code> 0.5:    cix[kk] -= 1
 */
      __pyx_t_23 = 2;
      __pyx_t_24 = __pyx_v_kk;
      if (__pyx_t_23 <code><</code> 0) __pyx_t_23 += __pyx_bshape_0_inpf;
      if (__pyx_t_24 <code><</code> 0) __pyx_t_24 += __pyx_bshape_1_inpf;
      __pyx_t_25 = 3;
      __pyx_t_26 = __pyx_v_kk;
      if (__pyx_t_25 <code><</code> 0) __pyx_t_25 += __pyx_bshape_0_inpf;
      if (__pyx_t_26 <code><</code> 0) __pyx_t_26 += __pyx_bshape_1_inpf;
      __pyx_v_x = ((((__pyx_v_pp[__pyx_v_kk]) - (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_inpf.buf, __pyx_t_23, __pyx_bstride_0_inpf, __pyx_t_24, __pyx_bstride_1_inpf))) / (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_inpf.buf, __pyx_t_25, __pyx_bstride_0_inpf, __pyx_t_26, __pyx_bstride_1_inpf))) + __pyx_v_ng);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:             cix[kk] = int(floor(x))</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":64
 * 
 *             x = (pp[kk] - inpf[2,kk])/inpf[3,kk] + ng;
 *             cix[kk] = int(floor(x))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if (x - 1.*cix[kk]) <code><</code> 0.5:    cix[kk] -= 1
 * 
 */
      (__pyx_v_cix[__pyx_v_kk]) = ((int)floor(__pyx_v_x));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:             if (x - 1.*cix[kk]) &lt; 0.5:    cix[kk] -= 1</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":65
 *             x = (pp[kk] - inpf[2,kk])/inpf[3,kk] + ng;
 *             cix[kk] = int(floor(x))
 *             if (x - 1.*cix[kk]) <code><</code> 0.5:    cix[kk] -= 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cc = int(cix[1]*idxs[3] + cix[0]);
 */
      __pyx_t_27 = ((__pyx_v_x - (1. * (__pyx_v_cix[__pyx_v_kk]))) <code><</code> 0.5);
      if (__pyx_t_27) {
        __pyx_t_28 = __pyx_v_kk;
        (__pyx_v_cix[__pyx_t_28]) = ((__pyx_v_cix[__pyx_t_28]) - 1);
        goto __pyx_L10;
      }
      __pyx_L10:;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66: </pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:         cc = int(cix[1]*idxs[3] + cix[0]);</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'>
    /* "mpm/src/gimp2_c.pyx":67
 *             if (x - 1.*cix[kk]) <code><</code> 0.5:    cix[kk] -= 1
 * 
 *         cc = int(cix[1]*idxs[3] + cix[0]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for jj in range(9):
 */
    __pyx_t_29 = 3;
    if (__pyx_t_29 <code><</code> 0) __pyx_t_29 += __pyx_bshape_0_idxs;
    __pyx_v_cc = ((int)(((__pyx_v_cix[1]) * (*__Pyx_BufPtrStrided1d(__pyx_t_3mpm_3src_7gimp2_c_ITYPE_t *, __pyx_bstruct_idxs.buf, __pyx_t_29, __pyx_bstride_0_idxs))) + (__pyx_v_cix[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68: </pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:         for jj in range(9):</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'>
    /* "mpm/src/gimp2_c.pyx":69
 *         cc = int(cix[1]*idxs[3] + cix[0]);
 * 
 *         for jj in range(9):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             idx = cc + idxs[jj];
 * 
 */
    for (__pyx_t_14 = 0; __pyx_t_14 <code><</code> 9; __pyx_t_14+=1) {
      __pyx_v_jj = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70:             idx = cc + idxs[jj];</pre>
<pre id='line70' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":70
 * 
 *         for jj in range(9):
 *             idx = cc + idxs[jj];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for kk in range(2):
 */
      __pyx_t_28 = __pyx_v_jj;
      if (__pyx_t_28 <code><</code> 0) __pyx_t_28 += __pyx_bshape_0_idxs;
      __pyx_v_idx = (__pyx_v_cc + (*__Pyx_BufPtrStrided1d(__pyx_t_3mpm_3src_7gimp2_c_ITYPE_t *, __pyx_bstruct_idxs.buf, __pyx_t_28, __pyx_bstride_0_idxs)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: </pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72:             for kk in range(2):</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":72
 *             idx = cc + idxs[jj];
 * 
 *             for kk in range(2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x = pp[kk] - gx[idx,kk]
 *                 r = fabs(x)
 */
      for (__pyx_t_30 = 0; __pyx_t_30 <code><</code> 2; __pyx_t_30+=1) {
        __pyx_v_kk = __pyx_t_30;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73:                 x = pp[kk] - gx[idx,kk]</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":73
 * 
 *             for kk in range(2):
 *                 x = pp[kk] - gx[idx,kk]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 r = fabs(x)
 *                 l = ll[kk]
 */
        __pyx_t_31 = __pyx_v_idx;
        __pyx_t_32 = __pyx_v_kk;
        if (__pyx_t_31 <code><</code> 0) __pyx_t_31 += __pyx_bshape_0_gx;
        if (__pyx_t_32 <code><</code> 0) __pyx_t_32 += __pyx_bshape_1_gx;
        __pyx_v_x = ((__pyx_v_pp[__pyx_v_kk]) - (*__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_gx.buf, __pyx_t_31, __pyx_bstride_0_gx, __pyx_t_32, __pyx_bstride_1_gx)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:                 r = fabs(x)</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":74
 *             for kk in range(2):
 *                 x = pp[kk] - gx[idx,kk]
 *                 r = fabs(x)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 l = ll[kk]
 *                 h = hh[kk]
 */
        __pyx_v_r = fabs(__pyx_v_x);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:                 l = ll[kk]</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":75
 *                 x = pp[kk] - gx[idx,kk]
 *                 r = fabs(x)
 *                 l = ll[kk]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 h = hh[kk]
 *                 sgn = 1. if x>0 else -1.
 */
        __pyx_v_l = (__pyx_v_ll[__pyx_v_kk]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:                 h = hh[kk]</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":76
 *                 r = fabs(x)
 *                 l = ll[kk]
 *                 h = hh[kk]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sgn = 1. if x>0 else -1.
 * 
 */
        __pyx_v_h = (__pyx_v_hh[__pyx_v_kk]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:                 sgn = 1. if x&gt;0 else -1.</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":77
 *                 l = ll[kk]
 *                 h = hh[kk]
 *                 sgn = 1. if x>0 else -1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 if (r <code><</code> l):
 */
        if ((__pyx_v_x > 0.0)) {
          __pyx_t_33 = 1.;
        } else {
          __pyx_t_33 = -1.;
        }
        __pyx_v_sgn = __pyx_t_33;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78: </pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:                 if (r &lt; l):</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":79
 *                 sgn = 1. if x>0 else -1.
 * 
 *                 if (r <code><</code> l):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     S[kk] = 1. - (r*r+l*l)/(2.*h*l)
 *                     G[kk] = -x/(h*l)
 */
        __pyx_t_27 = (__pyx_v_r <code><</code> __pyx_v_l);
        if (__pyx_t_27) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:                     S[kk] = 1. - (r*r+l*l)/(2.*h*l)</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":80
 * 
 *                 if (r <code><</code> l):
 *                     S[kk] = 1. - (r*r+l*l)/(2.*h*l)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     G[kk] = -x/(h*l)
 *                 elif (r <code><</code> h-l):
 */
          (__pyx_v_S[__pyx_v_kk]) = (1. - (((__pyx_v_r * __pyx_v_r) + (__pyx_v_l * __pyx_v_l)) / ((2. * __pyx_v_h) * __pyx_v_l)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:                     G[kk] = -x/(h*l)</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":81
 *                 if (r <code><</code> l):
 *                     S[kk] = 1. - (r*r+l*l)/(2.*h*l)
 *                     G[kk] = -x/(h*l)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 elif (r <code><</code> h-l):
 *                     S[kk] = 1. - r/h
 */
          (__pyx_v_G[__pyx_v_kk]) = ((-__pyx_v_x) / (__pyx_v_h * __pyx_v_l));
          goto __pyx_L15;
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:                 elif (r &lt; h-l):</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":82
 *                     S[kk] = 1. - (r*r+l*l)/(2.*h*l)
 *                     G[kk] = -x/(h*l)
 *                 elif (r <code><</code> h-l):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     S[kk] = 1. - r/h
 *                     G[kk] = -sgn/h
 */
        __pyx_t_27 = (__pyx_v_r <code><</code> (__pyx_v_h - __pyx_v_l));
        if (__pyx_t_27) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:                     S[kk] = 1. - r/h</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":83
 *                     G[kk] = -x/(h*l)
 *                 elif (r <code><</code> h-l):
 *                     S[kk] = 1. - r/h             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     G[kk] = -sgn/h
 *                 elif (r <code><</code> h+l):
 */
          (__pyx_v_S[__pyx_v_kk]) = (1. - (__pyx_v_r / __pyx_v_h));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:                     G[kk] = -sgn/h</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":84
 *                 elif (r <code><</code> h-l):
 *                     S[kk] = 1. - r/h
 *                     G[kk] = -sgn/h             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 elif (r <code><</code> h+l):
 *                     S[kk] = (h+l-r)*(h+l-r) / (4.*h*l)
 */
          (__pyx_v_G[__pyx_v_kk]) = ((-__pyx_v_sgn) / __pyx_v_h);
          goto __pyx_L15;
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85:                 elif (r &lt; h+l):</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'>
        /* "mpm/src/gimp2_c.pyx":85
 *                     S[kk] = 1. - r/h
 *                     G[kk] = -sgn/h
 *                 elif (r <code><</code> h+l):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     S[kk] = (h+l-r)*(h+l-r) / (4.*h*l)
 *                     G[kk] = (h+l-r) / (-2.*sgn*h*l)
 */
        __pyx_t_27 = (__pyx_v_r <code><</code> (__pyx_v_h + __pyx_v_l));
        if (__pyx_t_27) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:                     S[kk] = (h+l-r)*(h+l-r) / (4.*h*l)</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":86
 *                     G[kk] = -sgn/h
 *                 elif (r <code><</code> h+l):
 *                     S[kk] = (h+l-r)*(h+l-r) / (4.*h*l)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     G[kk] = (h+l-r) / (-2.*sgn*h*l)
 *                 else:
 */
          (__pyx_v_S[__pyx_v_kk]) = ((((__pyx_v_h + __pyx_v_l) - __pyx_v_r) * ((__pyx_v_h + __pyx_v_l) - __pyx_v_r)) / ((4. * __pyx_v_h) * __pyx_v_l));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87:                     G[kk] = (h+l-r) / (-2.*sgn*h*l)</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":87
 *                 elif (r <code><</code> h+l):
 *                     S[kk] = (h+l-r)*(h+l-r) / (4.*h*l)
 *                     G[kk] = (h+l-r) / (-2.*sgn*h*l)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 *                     S[kk] = 0.
 */
          (__pyx_v_G[__pyx_v_kk]) = (((__pyx_v_h + __pyx_v_l) - __pyx_v_r) / (((-2. * __pyx_v_sgn) * __pyx_v_h) * __pyx_v_l));
          goto __pyx_L15;
        }
        /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:                 else:</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89:                     S[kk] = 0.</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":89
 *                     G[kk] = (h+l-r) / (-2.*sgn*h*l)
 *                 else:
 *                     S[kk] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     G[kk] = 0.
 * 
 */
          (__pyx_v_S[__pyx_v_kk]) = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90:                     G[kk] = 0.</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'>
          /* "mpm/src/gimp2_c.pyx":90
 *                 else:
 *                     S[kk] = 0.
 *                     G[kk] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             cIdx[ii,jj] = idx
 */
          (__pyx_v_G[__pyx_v_kk]) = 0.;
        }
        __pyx_L15:;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: </pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92:             cIdx[ii,jj] = idx</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":92
 *                     G[kk] = 0.
 * 
 *             cIdx[ii,jj] = idx             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             cW[ii,jj] = S[0]*S[1]
 *             cGrad[ii,jj,0] = S[1]*G[0]
 */
      __pyx_t_30 = __pyx_v_ii;
      __pyx_t_34 = __pyx_v_jj;
      if (__pyx_t_30 <code><</code> 0) __pyx_t_30 += __pyx_bshape_0_cIdx;
      if (__pyx_t_34 <code><</code> 0) __pyx_t_34 += __pyx_bshape_1_cIdx;
      *__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_ITYPE_t *, __pyx_bstruct_cIdx.buf, __pyx_t_30, __pyx_bstride_0_cIdx, __pyx_t_34, __pyx_bstride_1_cIdx) = __pyx_v_idx;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:             cW[ii,jj] = S[0]*S[1]</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":93
 * 
 *             cIdx[ii,jj] = idx
 *             cW[ii,jj] = S[0]*S[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             cGrad[ii,jj,0] = S[1]*G[0]
 *             cGrad[ii,jj,1] = S[0]*G[1]
 */
      __pyx_t_35 = __pyx_v_ii;
      __pyx_t_36 = __pyx_v_jj;
      if (__pyx_t_35 <code><</code> 0) __pyx_t_35 += __pyx_bshape_0_cW;
      if (__pyx_t_36 <code><</code> 0) __pyx_t_36 += __pyx_bshape_1_cW;
      *__Pyx_BufPtrStrided2d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_cW.buf, __pyx_t_35, __pyx_bstride_0_cW, __pyx_t_36, __pyx_bstride_1_cW) = ((__pyx_v_S[0]) * (__pyx_v_S[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:             cGrad[ii,jj,0] = S[1]*G[0]</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":94
 *             cIdx[ii,jj] = idx
 *             cW[ii,jj] = S[0]*S[1]
 *             cGrad[ii,jj,0] = S[1]*G[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             cGrad[ii,jj,1] = S[0]*G[1]
 * 
 */
      __pyx_t_37 = __pyx_v_ii;
      __pyx_t_38 = __pyx_v_jj;
      __pyx_t_39 = 0;
      if (__pyx_t_37 <code><</code> 0) __pyx_t_37 += __pyx_bshape_0_cGrad;
      if (__pyx_t_38 <code><</code> 0) __pyx_t_38 += __pyx_bshape_1_cGrad;
      if (__pyx_t_39 <code><</code> 0) __pyx_t_39 += __pyx_bshape_2_cGrad;
      *__Pyx_BufPtrStrided3d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_cGrad.buf, __pyx_t_37, __pyx_bstride_0_cGrad, __pyx_t_38, __pyx_bstride_1_cGrad, __pyx_t_39, __pyx_bstride_2_cGrad) = ((__pyx_v_S[1]) * (__pyx_v_G[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:             cGrad[ii,jj,1] = S[0]*G[1]</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'>
      /* "mpm/src/gimp2_c.pyx":95
 *             cW[ii,jj] = S[0]*S[1]
 *             cGrad[ii,jj,0] = S[1]*G[0]
 *             cGrad[ii,jj,1] = S[0]*G[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return 0
 */
      __pyx_t_40 = __pyx_v_ii;
      __pyx_t_41 = __pyx_v_jj;
      __pyx_t_42 = 1;
      if (__pyx_t_40 <code><</code> 0) __pyx_t_40 += __pyx_bshape_0_cGrad;
      if (__pyx_t_41 <code><</code> 0) __pyx_t_41 += __pyx_bshape_1_cGrad;
      if (__pyx_t_42 <code><</code> 0) __pyx_t_42 += __pyx_bshape_2_cGrad;
      *__Pyx_BufPtrStrided3d(__pyx_t_3mpm_3src_7gimp2_c_FTYPE_t *, __pyx_bstruct_cGrad.buf, __pyx_t_40, __pyx_bstride_0_cGrad, __pyx_t_41, __pyx_bstride_1_cGrad, __pyx_t_42, __pyx_bstride_2_cGrad) = ((__pyx_v_S[0]) * (__pyx_v_G[1]));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96: </pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line97")'> 97:     return 0</pre>
<pre id='line97' class='code' style='background-color: #FFFF29'>
  /* "mpm/src/gimp2_c.pyx":97
 *             cGrad[ii,jj,1] = S[0]*G[1]
 * 
 *     return 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_r = __pyx_int_0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_mIdx);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_gx);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_pF);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_idxs);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_px);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cGrad);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cW);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_inpf);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_pVol);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cIdx);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("mpm.src.gimp2_c.updateContribs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_mIdx);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_gx);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_pF);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_idxs);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_px);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cGrad);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cW);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_inpf);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_pVol);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_cIdx);
  __pyx_L2:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre></body></html>
