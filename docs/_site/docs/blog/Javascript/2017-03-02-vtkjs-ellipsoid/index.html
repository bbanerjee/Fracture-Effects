<!DOCTYPE HTML>
<html class="no-js" lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plotting particles with vtk.js</title>
  <link rel="stylesheet" href="https://bbanerjee.github.io/ParSim/assets/css/screen.css">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov:400,700' rel='stylesheet' type='text/css'>
  <script src="https://bbanerjee.github.io/ParSim/assets/js/modernizr.min.js"></script>
</head>


<body class="wrap">

  <script type="text/javascript"
    src="http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML">
  </script>

  <header>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <h1>
        <a href="/">
          <span class="sr-only">ParSim</span>
          <img src="https://bbanerjee.github.io/ParSim/assets/img/ParresiaLogoDec2016.png" 
               width="249" height="115" alt="ParSim">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="https://bbanerjee.github.io/ParSim">Home</a>
  </li>
  <li class="current">
    <a href="https://bbanerjee.github.io/ParSim/docs/home">Vaango Docs</a>
  </li>
  <li>
    <a href="https://github.com/bbanerjee/ParSim">GitHub Source</a>
  </li>
</ul>

    </nav>
  </div>
</header>



    <section class="docs">
    <div class="grid">

      <div class="unit four-fifths">
        <article>
          <h1>Plotting particles with vtk.js</h1>
          <ul class="notice--content" id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#registering-vtk-components" id="markdown-toc-registering-vtk-components">Registering VTK components</a></li>
  <li><a href="#creating-vuex-stores-for-vtk-data" id="markdown-toc-creating-vuex-stores-for-vtk-data">Creating Vuex stores for VTK data</a></li>
  <li><a href="#the-vtk-graphics-panel" id="markdown-toc-the-vtk-graphics-panel">The VTK graphics panel</a></li>
  <li><a href="#the-vtk-renderer" id="markdown-toc-the-vtk-renderer">The VTK renderer</a></li>
  <li><a href="#the-vtk-particles-component" id="markdown-toc-the-vtk-particles-component">The VTK particles component</a></li>
  <li><a href="#creating-the-particles" id="markdown-toc-creating-the-particles">Creating the particles</a></li>
  <li><a href="#remarks" id="markdown-toc-remarks">Remarks</a></li>
</ul>

<h5 id="introduction">Introduction</h5>
<p>In the previous articles in this series we talked about:</p>

<ol>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/vue/vuex/xml/reading-vtk-particles/">Part 1: Reading VTK format particles with Javascript in a browser</a></li>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/vue/vuex/vuex-store/">Part 2: Saving the read-in particle data in a Vuex store</a></li>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs/">Part 3: Initialization of a store and the user interface</a>.</li>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs-renderer/">Part 4: Setting up the Three.js renderer</a></li>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs-camera/">Part 5: Setting up the Three.js scene and camera</a></li>
  <li><a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs-ellipsoid/">Part 6: Creating and plotting Three.js ellipsoids</a></li>
</ol>

<p>Let us now explore the <a href="https://kitware.github.io/vtk-js/">vtk.js</a> library to see if the process
of displaying particles can be simplified given that we are using VTK format input files.</p>

<h5 id="registering-vtk-components">Registering VTK components</h5>
<p>As discussed in <a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs/">Part 3</a>, we first
need to register components that are specific to VTK.  In our case, we need</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kd">var</span> <span class="nx">VtkRenderer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./graphics/VtkRenderer.vue&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">VtkEllipsoidParticles</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./graphics/VtkEllipsoidParticles.vue&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;vtk-renderer&#39;</span><span class="p">,</span> <span class="nx">VtkRenderer</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;vtk-ellipsoid-particles&#39;</span><span class="p">,</span> <span class="nx">VtkEllipsoidParticles</span><span class="p">);</span></code></pre></figure>

<h5 id="creating-vuex-stores-for-vtk-data">Creating Vuex stores for VTK data</h5>
<p>Once again, we repeat the process discussed in
<a href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs/">Part 3</a>.  We have discussed
the <code>Store</code> in Part3, and in this case we create the files</p>

<ul>
  <li><code>VTKGraphicsModule.ts</code> - similar to <code>ThreeGraphicsModule.ts</code></li>
  <li><code>VTKGraphicsState.ts</code> - see below</li>
  <li><code>VTKGraphicsGetters.ts</code> - similar to the getters for the three.js Vuex store</li>
  <li><code>VTKGraphicsMutations.ts</code> - see below</li>
  <li><code>VTKGraphicsActions.ts</code> - similar to what we have seen before</li>
</ul>

<p>The <code>VTKGraphicsState.ts</code> file now contains a list of actors, sources, and mappers.  There is also
a flag indicating that VTK actors have been created:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">VTKGraphicsState</span> <span class="p">{</span>
  <span class="nx">actors</span>     <span class="o">:</span> <span class="nx">any</span> <span class="p">[];</span>
  <span class="nx">sources</span>    <span class="o">:</span> <span class="nx">any</span> <span class="p">[];</span>
  <span class="nx">mappers</span>    <span class="o">:</span> <span class="nx">any</span> <span class="p">[];</span>
  <span class="nx">areVTKActorsCreated</span>  <span class="o">:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">actors</span>  <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sources</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mappers</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">areVTKActorsCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>The <code>VTKGraphicsMutations.ts</code> file contains the following:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">import</span> <span class="p">{</span><span class="nx">Mutation</span><span class="p">,</span> <span class="nx">MutationTree</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vuex&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VTKGraphicsState</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./VTKGraphicsState&#39;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">ADD_VTK_ACTOR</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span> <span class="nx">VTKGraphicsState</span><span class="p">,</span> <span class="nx">actor</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">actors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">actor</span><span class="p">);</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">ADD_VTK_SOURCE</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span> <span class="nx">VTKGraphicsState</span><span class="p">,</span> <span class="nx">source</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">ADD_VTK_MAPPER</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span> <span class="nx">VTKGraphicsState</span><span class="p">,</span> <span class="nx">mapper</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">mappers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mapper</span><span class="p">);</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">VTK_ACTORS_CREATED</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span> <span class="nx">VTKGraphicsState</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">areVTKActorsCreated</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="o">&lt;</span><span class="nx">MutationTree</span><span class="o">&lt;</span><span class="nx">VTKGraphicsState</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="nx">ADD_VTK_ACTOR</span><span class="p">,</span>
  <span class="nx">ADD_VTK_SOURCE</span><span class="p">,</span>
  <span class="nx">ADD_VTK_MAPPER</span><span class="p">,</span>
  <span class="nx">VTK_ACTORS_CREATED</span>
<span class="p">}</span></code></pre></figure>

<h5 id="the-vtk-graphics-panel">The VTK graphics panel</h5>
<p>The VTK graphics panel is simpler in this case.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;vtk-graphics-container&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-card uk-card-default uk-card-large&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;uk-card-body&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">vtk-renderer</span> <span class="na">v-bind:size</span><span class="o">=</span><span class="s">&quot;size&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">vtk-ellipsoid-particles</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">vtk-ellipsoid-particles</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">vtk-renderer</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./VtkGraphicsPanel.ts&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></figure>

<p class="notice-warning">The graphics panel template is simpler mainly because each actor is associated with a single
mapper and a single source in our implementation.  Better options will, one hopes,
become available after vtk.js reaches version 1.</p>

<h5 id="the-vtk-renderer">The VTK renderer</h5>
<p>We use a named slot for the template in the file <code>VtkRenderer.vue</code>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;vtk&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&quot;vtk-graphics-container&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./VtkRenderer.ts&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></figure>

<p>The code for the renderer is slight more complicated in this case and we add
an interactor to interact with the plot.  The <code>VtkRenderer.ts</code> code is listed below.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s2">&quot;vue&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Lifecycle</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">p</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;av-ts&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Store</span> <span class="nx">from</span> <span class="s1">&#39;./Store&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkRenderWindow</span>           <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/RenderWindow&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkRenderer</span>               <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/Renderer&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkOpenGLRenderWindow</span>     <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/OpenGL/RenderWindow&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkRenderWindowInteractor</span> <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/RenderWindowInteractor&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkTexture</span>                <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/Texture&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;VtkRenderer&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VtkRenderer</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Prop</span>
  <span class="nx">size</span> <span class="o">=</span> <span class="nx">p</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="c1">// { w, h }</span>
    <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">});</span>
  <span class="err">@</span><span class="nx">Prop</span>
  <span class="nx">renderWindow</span> <span class="o">=</span> <span class="nx">p</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">vtkRenderWindow</span>
  <span class="p">});</span>
  <span class="err">@</span><span class="nx">Prop</span>
  <span class="nx">renderer</span> <span class="o">=</span> <span class="nx">p</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">vtkRenderer</span>
  <span class="p">});</span>
  <span class="err">@</span><span class="nx">Prop</span>
  <span class="nx">openGLRenderWindow</span> <span class="o">=</span> <span class="nx">p</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">vtkOpenGLRenderWindow</span>
  <span class="p">});</span>
  <span class="err">@</span><span class="nx">Prop</span>
  <span class="nx">interactor</span> <span class="o">=</span> <span class="nx">p</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">vtkRenderWindowInteractor</span>
  <span class="p">});</span>
  <span class="kr">private</span> <span class="nx">_renderWindow</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="kr">private</span> <span class="nx">_renderer</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="kr">private</span> <span class="nx">_openGLRenderWindow</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="kr">private</span> <span class="nx">_interactor</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Lifecycle</span>
  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderWindow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderWindow</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">openGLRenderWindow</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_interactor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">interactor</span><span class="p">;</span>
    <span class="c1">// Create VTK render window and renderer</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderWindow</span> <span class="o">=</span> <span class="nx">vtkRenderWindow</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span> <span class="o">=</span> <span class="nx">vtkRenderer</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderWindow</span><span class="p">.</span><span class="nx">addRenderer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">.</span><span class="nx">setBackground</span><span class="p">(</span><span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">);</span>
    <span class="c1">// Create OpenGL renderwindow</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span> <span class="o">=</span> <span class="nx">vtkOpenGLRenderWindow</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_renderWindow</span><span class="p">.</span><span class="nx">addView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span><span class="p">);</span>
    <span class="c1">// Create interactor</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_interactor</span> <span class="o">=</span> <span class="nx">vtkRenderWindowInteractor</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
    <span class="c1">// Add watch to check for data updates</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">Store</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">areVTKActorsCreated</span><span class="p">;</span> <span class="p">},</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">areVTKActorsCreated</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">addActors</span><span class="p">();</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">.</span><span class="nx">resetCamera</span><span class="p">();</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">_renderWindow</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
  <span class="err">@</span><span class="nx">Lifecycle</span>
  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">)[</span><span class="s2">&quot;vtk-graphics-container&quot;</span><span class="p">])</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">el</span>  <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">)[</span><span class="s2">&quot;vtk-graphics-container&quot;</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span><span class="p">.</span><span class="nx">setContainer</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="c1">// Set the size of the window</span>
      <span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">).</span><span class="nx">w</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">).</span><span class="nx">h</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
      <span class="c1">// Add the actors from the store</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addActors</span><span class="p">();</span>
      <span class="c1">// Interactor</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_interactor</span><span class="p">.</span><span class="nx">setView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_openGLRenderWindow</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_interactor</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_interactor</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_renderWindow</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Get actors from the store and add to the scene</span>
  <span class="kr">private</span> <span class="nx">addActors</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">actors</span>  <span class="o">=</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">actors</span><span class="p">;</span>
    <span class="nx">actors</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">actor</span> <span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">index</span> <span class="o">:</span> <span class="nx">number</span><span class="p">){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">.</span><span class="nx">addActor</span><span class="p">(</span><span class="nx">actor</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p class="notice--info">The procedure used in this code is identical to that explained in the standard book on VTK.
You will be able to access that book <a href="http://www.vtk.org/vtk-textbook/">here</a>.</p>

<p class="notice--warning">The interactor allows only rotation and pan.  For zoom capabilities, you will need to you
a more capable interactor from the vtk.js library.</p>

<h5 id="the-vtk-particles-component">The VTK particles component</h5>
<p>To draw the particles, we use the following code</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s2">&quot;vue&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Data</span><span class="p">,</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Lifecycle</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">p</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;av-ts&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkActor</span>        <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/Actor&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkSphereSource</span> <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Filters/Sources/SphereSource&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">vtkMapper</span>       <span class="nx">from</span> <span class="s1">&#39;vtk.js/Sources/Rendering/Core/Mapper&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Store</span> <span class="nx">from</span> <span class="s2">&quot;./Store&quot;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;VtkEllipsoidParticles&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VtkEllipsoidParticles</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Lifecycle</span>
  <span class="kr">public</span> <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">Store</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">isParticleReadComplete</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">isParticleReadComplete</span><span class="p">)</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">createVTKParticles</span><span class="p">();</span>
                <span class="p">});</span>
  <span class="p">}</span>
  <span class="kr">private</span> <span class="nx">createVTKParticles</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// See below</span>
  <span class="p">}</span> </code></pre></figure>

<p>This part of the code is identical to that used for the three.js particles.</p>

<h5 id="creating-the-particles">Creating the particles</h5>
<p>The particle axis data are in the form of angles between the ellipsoid axes and the world coordinate axes.
These are converted directly into the appropriate rotation matrix.  Sphere objects are then created at
the origin, rotated, scaled, and translated to their actual positions.  The sphere objects are then
transformed into <code>SphereBufferGeometry</code> objects to make their manipulation slightly more efficient.
Finally, a “material” shading model is added to make sure that the image displayed isn’t flat and
a triangulated mesh is generated for each object.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span>  <span class="kr">private</span> <span class="nx">createVTKParticles</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Get the particle data</span>
    <span class="kd">let</span> <span class="nx">particles</span> <span class="o">=</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">particleData</span><span class="p">;</span>
    <span class="c1">// Extract the radius and center</span>
    <span class="kd">let</span> <span class="nx">radii</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="s2">&quot;Radius&quot;</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">centers</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="s2">&quot;Position&quot;</span><span class="p">];</span>
    <span class="c1">// Loop through particles</span>
    <span class="nx">radii</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">radius</span> <span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">index</span> <span class="o">:</span> <span class="nx">number</span><span class="p">){</span>
      <span class="c1">// Create the _mapper</span>
      <span class="kr">const</span> <span class="nx">mapper</span> <span class="o">=</span> <span class="nx">vtkMapper</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
      <span class="c1">// Create the actor</span>
      <span class="kr">const</span> <span class="nx">actor</span> <span class="o">=</span> <span class="nx">vtkActor</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
      <span class="nx">actor</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">().</span><span class="nx">setEdgeVisibility</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="nx">actor</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">().</span><span class="nx">setEdgeColor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
      <span class="c1">// Create the source</span>
      <span class="kr">const</span> <span class="nx">sphere</span> <span class="o">=</span> <span class="nx">vtkSphereSource</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">();</span>
      <span class="nx">sphere</span><span class="p">.</span><span class="nx">setPhiResolution</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
      <span class="nx">sphere</span><span class="p">.</span><span class="nx">setThetaResolution</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
      <span class="c1">// Get the radius ratios</span>
      <span class="kd">let</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">radius</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
      <span class="nx">sphere</span><span class="p">.</span><span class="nx">setRadius</span><span class="p">(</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="kd">let</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">centers</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="nx">sphere</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
      <span class="c1">// Set up the connections</span>
      <span class="nx">mapper</span><span class="p">.</span><span class="nx">setInputConnection</span><span class="p">(</span><span class="nx">sphere</span><span class="p">.</span><span class="nx">getOutputPort</span><span class="p">());</span>
      <span class="nx">actor</span><span class="p">.</span><span class="nx">setMapper</span><span class="p">(</span><span class="nx">mapper</span><span class="p">);</span>
      <span class="c1">// Save the data</span>
      <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;ADD_VTK_ACTOR&#39;</span><span class="p">,</span>  <span class="nx">actor</span><span class="p">);</span>
      <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;ADD_VTK_SOURCE&#39;</span><span class="p">,</span> <span class="nx">sphere</span><span class="p">);</span>
      <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;ADD_VTK_MAPPER&#39;</span><span class="p">,</span> <span class="nx">mapper</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;VTK_ACTORS_CREATED&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span></code></pre></figure>

<p class="notice--warning">Note that we did not rotate or scale the particles.  To do that you will have to write
your own code or wait until a more full-featured version of VTK is implemented by vtk.js.</p>

<h4 id="remarks">Remarks</h4>
<p>I ran into several issues while trying to use <code>vtk.js</code>.  The main ones were:</p>

<ul class="notice">
  <li>The <code>vtk.js</code> library needs to be transpiled using <code>babel</code> to avoid complaints about <code>import</code> statements
in the <code>webpack</code> bundle.</li>
  <li>All events are captured by the interactors used by <code>vtk.js</code> and it is difficult to use Vue’s
event handling capabilities with this library.</li>
  <li>Geometry transformations have not been implemented in <code>vtk.js</code> yet.</li>
  <li>Unstructured grid VTK XML files cannot yet be read in by <code>vtk.js</code> readers.</li>
  <li>The rendering process was much slower than that of <code>three.js</code>.</li>
</ul>

<p>The main advantages of <code>vtk.js</code> were:</p>

<ul class="notice">
  <li>The familiar architecture and API which is similar to what we have done in scientific visualization
for more than 20 years.</li>
  <li>The easy application of interactors (which was not the case with Typescript, Vue, and three.js, and
an interactor had to be written).  We will discuss the three.js interactor in a future article.</li>
</ul>

<p>A plot of the spheres produced by our code can be seen below.</p>

<p><img src="https://bbanerjee.github.io/ParSim/assets/blogimg/VTKGraphicsPanel.jpg" alt="Plot produced by Three.js" class="img-responsive center-image" height="450px" border="5px double red" /></p>

<p>If you have questions/comments/corrections, please contact banerjee at parresianz dot com dot zen (without the dot zen).</p>

<p><a class="twitter-share-button" href="https://twitter.com/intent/tweet" data-via="parresianz"> Tweet</a>
<script src="//platform.linkedin.com/in.js" type="text/javascript">
  lang: en_US
</script>
<script type="IN/Share" data-counter="right"></script></p>


          





  
  

  
  

  
  

  
  

  
  


        </article>
      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    
    <h4>Getting Started</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/home/">Welcome</a></li>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/quickstart/">Quick-start guide</a></li>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/installation/">Installation</a></li>

</ul>

    
    <h4>Vaango tutorials</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim"></a></li>

</ul>

    
    <h4>Vaango manuals</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim"></a></li>

</ul>

    
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit one-third center">
      <p>&copy;&nbsp;2017 under the terms of the <a href="https://github.com/bbanerjee/ParSim/blob/master/LICENSE">MIT&nbsp;License</a>.</p>
    </div>
    <div class="unit one-third align-right center">
      <p>
        Built with
        <a href="https://jekyllrb.com">
          <img src="https://bbanerjee.github.io/ParSim/assets/img/logo-2x.png" width = "70" height="30" alt="Jekyll">
        </a>
      </p>
    </div>
    <div class="unit one-third align-right center">
      <p>
        Hosted by
        <a href="https://github.com">
          <img src="https://bbanerjee.github.io/ParSim/assets/img/footer-logo.png" width="100" height="30" alt="GitHub • Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>

  
</body>
</html>
