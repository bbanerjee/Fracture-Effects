<!DOCTYPE HTML>
<html class="no-js" lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input files: Reading XML</title>
  <link rel="stylesheet" href="https://bbanerjee.github.io/ParSim/assets/css/screen.css">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov:400,700' rel='stylesheet' type='text/css'>
  <script src="https://bbanerjee.github.io/ParSim/assets/js/modernizr.min.js"></script>
</head>


<body class="wrap">

  <script type="text/javascript"
    src="http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML">
  </script>

  <header>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <h1>
        <a href="/">
          <span class="sr-only">ParSim</span>
          <img src="https://bbanerjee.github.io/ParSim/assets/img/ParresiaLogoDec2016.png" 
               width="249" height="115" alt="ParSim">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="https://bbanerjee.github.io/ParSim">Home</a>
  </li>
  <li class="current">
    <a href="https://bbanerjee.github.io/ParSim/docs/home">Vaango Docs</a>
  </li>
  <li>
    <a href="https://github.com/bbanerjee/ParSim">GitHub Source</a>
  </li>
</ul>

    </nav>
  </div>
</header>



    <section class="docs">
    <div class="grid">

      <div class="unit four-fifths">
        <article>
          <h1>Input files: Reading XML</h1>
          <p>Mechanics research codes are typically written by graduate students who aim
to get their work done as quickly as possible.  These codes are not meant 
to last beyond the publication of a few related papers.
As a result, typical input files have the form</p>

<pre><code class="language-bash">   0.000000e+00   -1.000000e+00   0.000000e+00   100   1   50
   6
   1 0
   1 -1 0 0 0 0 25
   1 0
   2 1 0 0 100 0 25
   1 0
   3 0 -1 0 50 -1 25
   1 0
   4 0 1 0 50 1 25
   1 0
   5 0 0 -1 50 0 0
   1 0
   6 0 0 1 50 0 50
</code></pre>

<p>These files have the advantage that they can be read in quickly using an input 
file stream and the code for doing that can be written in minutes.</p>

<h5 id="the-problem">The problem</h5>
<p>But sometimes these code last beyond the tenure of the student, and some other
person (or the student her/himself) has to try to understand the format of the 
input file.  That process can take hours and sometimes days, especially if the
format has not been docsumented and the next person has to dig into the code to 
understand what each of the numbers means.</p>

<h5 id="the-xml-approach">The XML Approach</h5>
<p>One potential approach is to use XML to mark-up the input file which 
can be transformed into:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>  <span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;ISO-8859-1&#39; ?&gt;</span>
  <span class="nt">&lt;Boundary&gt;</span>
    <span class="c">&lt;!-- Container limits --&gt;</span>
    <span class="nt">&lt;containerMin&gt;</span>  [0.0,  -1.0,  0.0] <span class="nt">&lt;/containerMin&gt;</span>
    <span class="nt">&lt;containerMax&gt;</span>  [100.0, 1.0, 50.0] <span class="nt">&lt;/containerMax&gt;</span>
    <span class="c">&lt;!-- Internal boundaries --&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [-1.0, 0.0, 0.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [100.0, 0.0, 25.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [1.0, 0.0, 0.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [100.0, 0.0, 25.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [0.0, -1.0, 0.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [50.0, -1.0, 25.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [0.0, 1.0, 0.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [50.0, 1.0, 25.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;5&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [0.0, 0.0, -1.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [50.0, 0.0, 0.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
    <span class="nt">&lt;boundary</span> <span class="na">type=</span><span class="s">&quot;plane&quot;</span> <span class="na">id=</span><span class="s">&quot;6&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;direction&gt;</span> [0.0, 0.0, 1.0] <span class="nt">&lt;/direction&gt;</span>
      <span class="nt">&lt;position&gt;</span> [50.0, 0.0, 50.0] <span class="nt">&lt;/position&gt;</span>
    <span class="nt">&lt;/boundary&gt;</span>
  <span class="nt">&lt;/Boundary&gt;</span></code></pre></figure>

<p>Though this file is more verbose that the original, the user does not have to read the 
source code to understand the format of the file and what the various numbers mean.
The challenge for mechanics researchers is parsing and reading that sort of format.
Below I’ll show you how that’s done quickly and easily with modern C++.</p>

<h5 id="reading-xml">Reading XML</h5>
<p>For production codes such as <a href="https://github.com/bbanerjee/ParSim/tree/master/Vaango">Vaango</a> we use full featured libraries such as <a href="https://xerces.apache.org/xerces-c/">Xerces</a> or <a href="http://xmlsoft.org/">LibXml2</a>.  However, for research codes, there are a number of simpler alternatives.  I prefer the header-only style provided by <a href="http://zenxml.sourceforge.net/">ZenXml</a>.</p>

<p>The reader code is quite straightforward.  Let’s encapsulate it in the class
<code>BoundaryReader</code>.</p>

<p>First, the header <code>BoundaryReader.h</code></p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="cp">#ifndef BOUNDARY_READER_H</span>
<span class="cp">#define BOUNDARY_READER_H</span>

<span class="k">class</span> <span class="nc">BoundaryReader</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">BoundaryReader</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="o">~</span><span class="n">BoundaryReader</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="nf">readXML</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">inputFileName</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span> 
<span class="k">private</span><span class="o">:</span>
  <span class="n">BoundaryReader</span><span class="p">(</span><span class="n">BoundaryReader</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// don&#39;t implement</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">BoundaryReader</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// don&#39;t implement</span>
<span class="p">};</span>

<span class="cp">#endif</span></code></pre></figure>

<p>and then the implementation <code>BoundaryReader.cc</code></p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="cp">#include</span> <span class="cpf">&lt;BoundaryReader.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;zenxml/xml.h&gt;</span><span class="cp"></span>
<span class="kt">bool</span>
<span class="n">BoundaryReader</span><span class="o">::</span><span class="n">readXML</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">inputFileName</span><span class="p">)</span> <span class="k">const</span> 
<span class="p">{</span>
  <span class="c1">// Read the input file</span>
  <span class="n">zen</span><span class="o">::</span><span class="n">XmlDoc</span> <span class="n">docs</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Input file name= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">inputFileName</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">zen</span><span class="o">::</span><span class="n">load</span><span class="p">(</span><span class="n">inputFileName</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">zen</span><span class="o">::</span><span class="n">XmlFileError</span><span class="o">&amp;</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*ERROR** Could not read input file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">inputFileName</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;    Error # = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">lastError</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">zen</span><span class="o">::</span><span class="n">XmlParsingError</span><span class="o">&amp;</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*ERROR** Could not read input file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">inputFileName</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;    Parse Error in line: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; col: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">col</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Load the docsument into input proxy for easier element access</span>
  <span class="n">zen</span><span class="o">::</span><span class="n">XmlIn</span> <span class="n">ps</span><span class="p">(</span><span class="n">docs</span><span class="p">);</span>

  <span class="c1">// Read the boundary information</span>
  <span class="k">auto</span> <span class="n">boundary_ps</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s">&quot;Boundary&quot;</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">boundary_ps</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**ERROR** &lt;Boundary&gt; tag not found. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Read the container dimensions</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">vecStr</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">boundary_ps</span><span class="p">[</span><span class="s">&quot;containerMin&quot;</span><span class="p">](</span><span class="n">vecStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;**ERROR** Container min. position not found in boundary geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  Add the &lt;containerMin&gt; [x, y, z] &lt;/containerMin&gt; tag.&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Vec</span> <span class="n">boxMin</span> <span class="o">=</span> <span class="n">Vec</span><span class="o">::</span><span class="n">fromString</span><span class="p">(</span><span class="n">vecStr</span><span class="p">);</span> <span class="c1">// Convert the string [x, y, z]</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">boundary_ps</span><span class="p">[</span><span class="s">&quot;containerMax&quot;</span><span class="p">](</span><span class="n">vecStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">....</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Vec</span> <span class="n">boxMax</span> <span class="o">=</span> <span class="n">Vec</span><span class="o">::</span><span class="n">fromString</span><span class="p">(</span><span class="n">vecStr</span><span class="p">);</span> <span class="c1">// Convert the string [x, y, z]</span>

  <span class="c1">// Read each boundary</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">bound_ps</span> <span class="o">=</span> <span class="n">boundary_ps</span><span class="p">[</span><span class="s">&quot;boundary&quot;</span><span class="p">];</span> <span class="n">bound_ps</span><span class="p">;</span> <span class="n">bound_ps</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">boundaryType</span><span class="p">;</span>
    <span class="n">bound_ps</span><span class="p">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="n">boundaryType</span><span class="p">);</span>
    <span class="n">BoundaryId</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">bound_ps</span><span class="p">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bound_ps</span><span class="p">[</span><span class="s">&quot;direction&quot;</span><span class="p">](</span><span class="n">vecStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="p">....</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">Vec</span><span class="o">::</span><span class="n">fromString</span><span class="p">(</span><span class="n">vecStr</span><span class="p">);</span> <span class="c1">// Convert the string into a vector</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bound_ps</span><span class="p">[</span><span class="s">&quot;position&quot;</span><span class="p">](</span><span class="n">vecStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="p">....</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="n">position</span> <span class="o">=</span> <span class="n">Vec</span><span class="o">::</span><span class="n">fromString</span><span class="p">(</span><span class="n">vecStr</span><span class="p">);</span> <span class="c1">// Convert the string into a vector</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Of course, if you want to use the data that you have read, you will have to 
save them.  That’s left as an exercise for the reader.  As you can see, reading
a XML file can be quite straightforward and you have checks on the validity of
your file along each step of the reading process.</p>

<h4 id="conclusion">Conclusion</h4>
<p>I recommend shifting the XML or some other similar structured format for 
the input files in your research codes.  However, you may think that the
XML format is too verbose.  In that case I’d suggest using <a href="http://www.json.org/">JSON</a>
and in a future post I’ll show you how to read JSON in C++.</p>

<p>If you have questions/comments/corrections, please contact banerjee at parresianz dot com dot zen (without the dot zen).</p>

<p><a href="https://twitter.com/share" class="twitter-share-button" data-via="parresianz">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(docsument, 'script', 'twitter-wjs');</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">
  lang: en_US
</script>
<script type="IN/Share" data-counter="right"></script></p>

<!-- <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=cpp&amp;skin=sunburst"></script> -->

          





  
  

  
  

  
  

  
  

  
  


        </article>
      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    
    <h4>Getting Started</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/home/">Welcome</a></li>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/quickstart/">Quick-start guide</a></li>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim/docs/installation/">Installation</a></li>

</ul>

    
    <h4>Vaango tutorials</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim"></a></li>

</ul>

    
    <h4>Vaango manuals</h4>
    <ul>

  
  
  <li class=""><a href="https://bbanerjee.github.io/ParSim"></a></li>

</ul>

    
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit one-third center">
      <p>&copy;&nbsp;2017 under the terms of the <a href="https://github.com/bbanerjee/ParSim/blob/master/LICENSE">MIT&nbsp;License</a>.</p>
    </div>
    <div class="unit one-third align-right center">
      <p>
        Built with
        <a href="https://jekyllrb.com">
          <img src="https://bbanerjee.github.io/ParSim/assets/img/logo-2x.png" width = "70" height="30" alt="Jekyll">
        </a>
      </p>
    </div>
    <div class="unit one-third align-right center">
      <p>
        Hosted by
        <a href="https://github.com">
          <img src="https://bbanerjee.github.io/ParSim/assets/img/footer-logo.png" width="100" height="30" alt="GitHub • Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>

  
</body>
</html>
